import e,{useEffect as n,useLayoutEffect as l,useState as o,useRef as i,useCallback as a,useReducer as r,useMemo as t,createContext as d,useContext as u}from"react";import{GroupChannelListOrder as s,GroupChannelHandler as v,GroupChannelFilter as c,GroupChannelEventSource as h,MessageFilter as p,MessageCollectionInitPolicy as g}from"@sendbird/chat/groupChannel";import{CollectionEventSource as f}from"@sendbird/chat";import{SendingStatus as C}from"@sendbird/chat/message";const b={reactions:"reactions",message_search_v3:"message_search_v3",enable_og_tag:"enable_og_tag",enable_message_threading:"enable_message_threading",allow_broadcast_channel:"allow_broadcast_channel",allow_super_group_channel:"allow_super_group_channel"};const y={reactions:"reactions",moderation_group:"moderation_group",message_search_v3:"message_search_v3",data_export:"data_export",migration:"migration",delivery_receipt:"delivery_receipt",auto_thumbnail:"auto_thumbnail",image_moderation:"image_moderation",super_group_channel:"super_group_channel",announcement:"announcement",moderation_open:"moderation_open",desk:"desk",bot_interface:"bot_interface",auto_trans:"auto_trans"};const m={collection:{groupChannel:{defaultLimit:20,defaultOrder:s.LATEST_LAST_MESSAGE,defaultIncludeEmpty:false},message:{defaultLimit:{next:25,prev:25},searchLimit:{next:10,prev:10}}}};var M=(void 0,function(e,n,l,o){function adopt(e){return e instanceof l?e:new l((function(n){n(e)}))}return new(l||(l=Promise))((function(l,i){function fulfilled(e){try{step(o.next(e))}catch(e){i(e)}}function rejected(e){try{step(o.throw(e))}catch(e){i(e)}}function step(e){e.done?l(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,n||[])).next())}))});const useAsyncEffect=(e,l)=>{n(createAsyncEffectCallback(e),l)};const useAsyncLayoutEffect=(e,n)=>{l(createAsyncEffectCallback(e),n)};const iife$1=e=>e();const createAsyncEffectCallback=e=>()=>{const n=iife$1(e);return()=>{n&&iife$1(n instanceof Promise?()=>M(void 0,void 0,void 0,(function*(){const e=yield n;e&&e()})):n)}};let _=0;function useUniqId(){return o((()=>""+_++))[0]}const useGroupChannelHandler=(e,l,o)=>{const a=i(l);const r=useUniqId();const t=o!==null&&o!==void 0?o:r;a.current=l;n((()=>{var n;const handlerMapper=e=>{const n=Object.keys(e);n.forEach((n=>{e[n]=(...e)=>{var l,o;return(o=(l=a.current)===null||l===void 0?void 0:l[n])===null||o===void 0?void 0:o.call(l,...e)}}));return e};(n=e===null||e===void 0?void 0:e.groupChannel)===null||n===void 0?void 0:n.addGroupChannelHandler(t,handlerMapper(new v));return()=>{var n;(n=e===null||e===void 0?void 0:e.groupChannel)===null||n===void 0?void 0:n.removeGroupChannelHandler(t)}}),[e===null||e===void 0?void 0:e.groupChannel,t])};
/**
 * Preserves a reference to the given callback function as an argument while the component is mounted.
 * Wraps the given callback in React's Ref to preserve the reference.
 * @param callback want to be preserved
 */function usePreservedCallback(e){const n=i(e);n.current=e;return a(((...e)=>n.current(...e)),[n])}var I=(void 0,function(e,n){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(l[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols==="function"){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)n.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l});const defaultReducer$1=(e,n)=>{var l=I(e,[]);const o=createCompareByOrder(l.order);switch(n.type){case"update_refreshing":l.refreshing=n.value.status;break;case"update_initialized":l.initialized=n.value.status;break;case"update_channels":getGroupChannels(n.value.channels).forEach((e=>{const n=l.groupChannels.findIndex((n=>n.url===e.url));n>-1&&(l.groupChannels[n]=e)}));o&&(l.groupChannels=l.groupChannels.sort(o));break;case"delete_channels":n.value.channelUrls.forEach((e=>{const n=l.groupChannels.findIndex((n=>n.url===e));n>-1&&l.groupChannels.splice(n,1)}));o&&(l.groupChannels=l.groupChannels.sort(o));break;case"append_channels":{const e=getGroupChannels(n.value.channels);n.value.clearBeforeAction?l.groupChannels=e:l.groupChannels=mergeObjectArrays(l.groupChannels,e,"url");o&&(l.groupChannels=l.groupChannels.sort(o));break}case"update_order":{l.order=n.value.order;const e=createCompareByOrder(l.order);e&&(l.groupChannels=l.groupChannels.sort(e));break}}return l};const useGroupChannelListReducer=e=>{const[{initialized:n,refreshing:l,groupChannels:o},i]=r(defaultReducer$1,{initialized:false,refreshing:false,groupChannels:[],order:e});const updateChannels=e=>{i({type:"update_channels",value:{channels:e}})};const deleteChannels=e=>{i({type:"delete_channels",value:{channelUrls:e}})};const appendChannels=(e,n)=>{i({type:"append_channels",value:{channels:e,clearBeforeAction:n}})};const updateInitialized=e=>{i({type:"update_initialized",value:{status:e}})};const updateRefreshing=e=>{i({type:"update_refreshing",value:{status:e}})};const updateOrder=e=>{i({type:"update_order",value:{order:e}})};return{updateInitialized:updateInitialized,updateRefreshing:updateRefreshing,updateChannels:updateChannels,deleteChannels:deleteChannels,appendChannels:appendChannels,updateOrder:updateOrder,initialized:n,refreshing:l,groupChannels:o}};const createCompareByOrder=e=>{if(e)return(n,l)=>{switch(e){case"latest_last_message":return n.lastMessage&&l.lastMessage?l.lastMessage.createdAt-n.lastMessage.createdAt:n.lastMessage?-1:l.lastMessage?1:l.createdAt-n.createdAt;case"chronological":return l.createdAt-n.createdAt;case"channel_name_alphabetical":return n.name.localeCompare(l.name);default:return 0}}};function mergeObjectArrays(e,n,l){const o=new Set(e.map((e=>e[l])));const i=[...e];for(let e=0;e<n.length;e++)if(!o.has(n[e][l])){i.push(n[e]);o.add(n[e][l])}return i}function getGroupChannels(e){return e.filter((e=>e.isGroupChannel()))}var S=(void 0,function(e,n,l,o){function adopt(e){return e instanceof l?e:new l((function(n){n(e)}))}return new(l||(l=Promise))((function(l,i){function fulfilled(e){try{step(o.next(e))}catch(e){i(e)}}function rejected(e){try{step(o.throw(e))}catch(e){i(e)}}function step(e){e.done?l(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,n||[])).next())}))});const createGroupChannelListCollection=(e,n)=>{const l={includeEmpty:m.collection.groupChannel.defaultIncludeEmpty,limit:m.collection.groupChannel.defaultLimit,order:m.collection.groupChannel.defaultOrder};const o=n===null||n===void 0?void 0:n(l);return o||e.groupChannel.createGroupChannelCollection(Object.assign(Object.assign({},l),{filter:new c(l)}))};const useGroupChannelList=(e,l)=>{var o,a,r;const t=Boolean((a=(o=e.appInfo)===null||o===void 0?void 0:o.premiumFeatureList)===null||a===void 0?void 0:a.includes(y.delivery_receipt));const d=i();const u=i(l);u.current=l;const{initialized:s,groupChannels:v,refreshing:c,appendChannels:p,deleteChannels:g,updateRefreshing:f,updateInitialized:C}=useGroupChannelListReducer();const updateChannelsAndMarkAsDelivered=(e,n,l)=>{var o,i,a,r;const s=(i=(o=d.current)===null||o===void 0?void 0:o.channels)!==null&&i!==void 0?i:[];p(s,true);if(e&&t)switch(n){case h.EVENT_MESSAGE_RECEIVED:case h.EVENT_MESSAGE_SENT:case h.SYNC_CHANNEL_BACKGROUND:case h.SYNC_CHANNEL_CHANGELOGS:case void 0:(r=(a=u.current)===null||a===void 0?void 0:a.markAsDelivered)===null||r===void 0?void 0:r.call(a,l!==null&&l!==void 0?l:s);break}};const b=usePreservedCallback((n=>S(void 0,void 0,void 0,(function*(){var o,i,a,r;d.current&&((o=d.current)===null||o===void 0?void 0:o.dispose());if(n){d.current=createGroupChannelListCollection(e,l===null||l===void 0?void 0:l.collectionCreator);(i=d.current)===null||i===void 0?void 0:i.setGroupChannelCollectionHandler({onChannelsAdded:(e,n)=>{var l,o;const i=n.filter((e=>e.isGroupChannel()));updateChannelsAndMarkAsDelivered(true,e.source,i);(o=(l=u.current)===null||l===void 0?void 0:l.onChannelsAdded)===null||o===void 0?void 0:o.call(l,i)},onChannelsUpdated:(e,n)=>{var l,o;const i=n.filter((e=>e.isGroupChannel()));updateChannelsAndMarkAsDelivered(true,e.source,i);(o=(l=u.current)===null||l===void 0?void 0:l.onChannelsUpdated)===null||o===void 0?void 0:o.call(l,i)},onChannelsDeleted:(e,n)=>{var l,o;updateChannelsAndMarkAsDelivered(false);(o=(l=u.current)===null||l===void 0?void 0:l.onChannelsDeleted)===null||o===void 0?void 0:o.call(l,n)}});if((a=d.current)===null||a===void 0?void 0:a.hasMore){yield(r=d.current)===null||r===void 0?void 0:r.loadMore();updateChannelsAndMarkAsDelivered(true)}}}))));n((()=>()=>{var e;d.current&&((e=d.current)===null||e===void 0?void 0:e.dispose())}),[]);useAsyncEffect((()=>S(void 0,void 0,void 0,(function*(){C(false);if(e.currentUser){yield b(e.currentUser.userId);C(true)}}))),[e,(r=e.currentUser)===null||r===void 0?void 0:r.userId]);useGroupChannelHandler(e,{onUserBanned:(n,l)=>{var o,i,a;const r=l.userId===((o=e.currentUser)===null||o===void 0?void 0:o.userId);if(r){g([n.url]);(a=(i=u.current)===null||i===void 0?void 0:i.onChannelsDeleted)===null||a===void 0?void 0:a.call(i,[n.url])}else updateChannelsAndMarkAsDelivered(false)}});const m=usePreservedCallback((()=>S(void 0,void 0,void 0,(function*(){if(e.currentUser){f(true);yield b(e.currentUser.userId);f(false)}}))));const M=usePreservedCallback((()=>S(void 0,void 0,void 0,(function*(){var e,n;if((e=d.current)===null||e===void 0?void 0:e.hasMore){yield(n=d.current)===null||n===void 0?void 0:n.loadMore();updateChannelsAndMarkAsDelivered(true)}}))));return{initialized:s,groupChannels:v,refresh:m,refreshing:c,loadMore:M}};
/**
 * Diff utils for channel
 * @param {BaseChannel} [a]
 * @param {BaseChannel} [b]
 * @returns {boolean}
 * */function isDifferentChannel(e,n){return!e||!n||e.url!==n.url}function isSendableMessage(e){return e!==void 0&&e!==null&&"sendingStatus"in e}function isMyMessage(e,n="##__USER_ID_IS_NOT_PROVIDED__##"){var l;return!!isSendableMessage(e)&&((l=e.sender)===null||l===void 0?void 0:l.userId)===n}function isNewMessage(e,n){const l=isMyMessage(e,n);return!l&&(!e.isAdminMessage()&&e.updatedAt===0)}function getMessageUniqId(e){return"sendingStatus"in e?e.sendingStatus==="succeeded"?String(e.messageId):e.reqId:String(e.messageId)}function isBoolean(e){return typeof e==="boolean"}function isOneOf(e,n){return n.includes(e)}function isSet(e){return e instanceof Set}function isNotEmptyArray(e){return!(!e||!Array.isArray(e))&&e.length!==0}function isSameType(e,n){return Object.prototype.toString.call(e)===Object.prototype.toString.call(n)}const useForceUpdate=()=>{const[,e]=o(0);return a((()=>e((e=>e+1))),[])};function snakeToCamel(e){if(typeof e!=="object"||e===null)return e;if(Array.isArray(e))return e.map((e=>snakeToCamel(e)));const n={};Object.keys(e).forEach((l=>{const o=l.replace(/_\w/g,(e=>e[1].toUpperCase()));n[o]=snakeToCamel(e[l])}));return n}function arrayToMapWithGetter(e,n){return e.reduce(((e,l)=>{const o=n(l);e[o]=l;return e}),{})}var U=(void 0,function(e,n){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(l[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols==="function"){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)n.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l});const defaultReducer=(e,n)=>{var l=U(e,[]);switch(n.type){case"update_initialized":l.initialized=n.value.status;return l;case"update_refreshing":l.refreshing=n.value.status;return l;case"update_loading":l.loading=n.value.status;return l;case"update_messages":{const e=n.value.currentUserId;if(n.value.clearBeforeAction)l.messageMap=messagesToObject(n.value.messages);else{const o=n.value.messages.filter((n=>{var o;if(isMyMessage(n,e)){const i=(o=l.messageMap[n.reqId])!==null&&o!==void 0?o:l.messageMap[n.messageId];if(isMyMessage(i,e)){const e=shouldUpdateMessage(i,n);if(e){delete l.messageMap[i.reqId];delete l.messageMap[i.messageId]}return e}}return true}));const i=messagesToObject(o);l.messageMap=Object.assign(Object.assign({},l.messageMap),i)}return l}case"update_new_messages":{const e=n.value.currentUserId;const o=n.value.messages.filter((n=>isNewMessage(n,e)));if(n.value.clearBeforeAction)l.newMessageMap=arrayToMapWithGetter(o,getMessageUniqId);else{const e=o.map((e=>e.messageId));e.forEach((e=>delete l.newMessageMap[e]));l.newMessageMap=Object.assign(Object.assign({},l.newMessageMap),arrayToMapWithGetter(o,getMessageUniqId))}return l}case"delete_messages":case"delete_new_messages":{const e=n.type==="delete_messages"?"messageMap":"newMessageMap";l[e]=Object.assign({},l[e]);n.value.messageIds.forEach((n=>{const o=l[e][n];if(o){isSendableMessage(o)&&delete l[e][o.reqId];delete l[e][o.messageId]}}));n.value.reqIds.forEach((n=>{const o=l[e][n];if(o){isSendableMessage(o)&&delete l[e][o.reqId];delete l[e][o.messageId]}}));return l}}};const messagesToObject=e=>e.reduce(((e,n)=>{if(isSendableMessage(n)){e[n.reqId]=n;n.sendingStatus===C.SUCCEEDED&&(e[n.messageId]=n)}else e[n.messageId]=n;return e}),{});const shouldUpdateMessage=(e,n)=>e.sendingStatus===C.SUCCEEDED?n.sendingStatus===C.SUCCEEDED:e.sendingStatus!==n.sendingStatus;const useChannelMessagesReducer=(e=defaultMessageComparator)=>{const[{initialized:n,loading:l,refreshing:o,messageMap:i,newMessageMap:a},d]=r(defaultReducer,{initialized:false,loading:true,refreshing:false,messageMap:{},newMessageMap:{}});const updateMessages=(e,n,l)=>{d({type:"update_messages",value:{messages:e,clearBeforeAction:n,currentUserId:l}})};const deleteMessages=(e,n)=>{d({type:"delete_messages",value:{messageIds:e,reqIds:n}})};const updateNewMessages=(e,n,l)=>{d({type:"update_new_messages",value:{messages:e,clearBeforeAction:n,currentUserId:l}})};const deleteNewMessages=(e,n)=>{d({type:"delete_new_messages",value:{messageIds:e,reqIds:n}})};const updateInitialized=e=>{d({type:"update_initialized",value:{status:e}})};const updateLoading=e=>{d({type:"update_loading",value:{status:e}})};const updateRefreshing=e=>{d({type:"update_refreshing",value:{status:e}})};const u=Object.values(a);const s=t((()=>Array.from(new Set(Object.values(i))).sort(e)),[i]);return{updateInitialized:updateInitialized,updateLoading:updateLoading,updateRefreshing:updateRefreshing,updateMessages:updateMessages,deleteMessages:deleteMessages,initialized:n,loading:l,refreshing:o,messages:s,newMessages:u,updateNewMessages:updateNewMessages,deleteNewMessages:deleteNewMessages}};const P=Math.floor(Number.MAX_SAFE_INTEGER/10);function defaultMessageComparator(e,n){let l=0;let o=0;isSendableMessage(e)&&e.sendingStatus!=="succeeded"&&(l=P);isSendableMessage(n)&&n.sendingStatus!=="succeeded"&&(o=P);return e.createdAt+l-(n.createdAt+o)}var E=(void 0,function(e,n,l,o){function adopt(e){return e instanceof l?e:new l((function(n){n(e)}))}return new(l||(l=Promise))((function(l,i){function fulfilled(e){try{step(o.next(e))}catch(e){i(e)}}function rejected(e){try{step(o.throw(e))}catch(e){i(e)}}function step(e){e.done?l(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,n||[])).next())}))});const createMessageCollection=(e,n,l)=>{var o;const i={prevResultLimit:n.prev,nextResultLimit:n.next,startingPoint:l===null||l===void 0?void 0:l.startingPoint,replyType:l===null||l===void 0?void 0:l.replyType};const a=(o=l===null||l===void 0?void 0:l.collectionCreator)===null||o===void 0?void 0:o.call(l,i);return a||e.createMessageCollection(Object.assign(Object.assign({},i),{filter:new p(i)}))};function getCollectionLimitBy(e){return e<Date.now()?m.collection.message.searchLimit:m.collection.message.defaultLimit}const useGroupChannelMessages=(e,o,a={})=>{var r,t,d;const u=i(a);u.current=a;const s=i(o);s.current=o;const v=u.current.logger;const c=(r=u.current.startingPoint)!==null&&r!==void 0?r:Number.MAX_SAFE_INTEGER;const h=getCollectionLimitBy(c);const p=i({prev:false,next:false});const C=useForceUpdate();const b=i({initialized:false,apiInitialized:false,instance:null});const{initialized:y,loading:M,refreshing:_,messages:I,newMessages:S,updateMessages:U,updateNewMessages:P,deleteNewMessages:w,deleteMessages:A,updateInitialized:O,updateLoading:R,updateRefreshing:B}=useChannelMessagesReducer(a===null||a===void 0?void 0:a.sortComparator);const T=usePreservedCallback((e=>{var n,l,o,i;if(!s.current||!s.current.url)return(n=v===null||v===void 0?void 0:v.error)===null||n===void 0?void 0:n.call(v,"[useGroupChannelMessages] channel is required");try{switch(e){case f.EVENT_MESSAGE_RECEIVED:case f.EVENT_MESSAGE_SENT_SUCCESS:case f.SYNC_MESSAGE_FILL:case void 0:(o=(l=u.current).markAsRead)===null||o===void 0?void 0:o.call(l,[s.current]);break}}catch(e){(i=v===null||v===void 0?void 0:v.warn)===null||i===void 0?void 0:i.call(v,"[useGroupChannelMessages/markAsReadBySource]",e)}}));const k=usePreservedCallback(((n,l)=>{var o,i,a,r,t;const d=l.filter((n=>{var l;return!isMyMessage(n,(l=e.currentUser)===null||l===void 0?void 0:l.userId)}));if(d.length>0)switch(n){case f.EVENT_MESSAGE_RECEIVED:case f.SYNC_MESSAGE_FILL:((i=(o=u.current).shouldCountNewMessages)===null||i===void 0?void 0:i.call(o))&&P(d,false,(a=e.currentUser)===null||a===void 0?void 0:a.userId);(t=(r=u.current).onMessagesReceived)===null||t===void 0?void 0:t.call(r,d);break}}));const D=usePreservedCallback(((n,l)=>E(void 0,void 0,void 0,(function*(){return new Promise((o=>{var i,a;if(!s.current||!s.current.url)return(i=v===null||v===void 0?void 0:v.error)===null||i===void 0?void 0:i.call(v,"[useGroupChannelMessages] channel is required");b.current.instance&&b.current.instance.dispose();T();P([],true,(a=e.currentUser)===null||a===void 0?void 0:a.userId);const updateUnsentMessages=()=>{var n,l,o;const{pendingMessages:i,failedMessages:a}=(n=b.current.instance)!==null&&n!==void 0?n:{};isNotEmptyArray(i)&&U(i,false,(l=e.currentUser)===null||l===void 0?void 0:l.userId);isNotEmptyArray(a)&&U(a,false,(o=e.currentUser)===null||o===void 0?void 0:o.userId)};const r=createMessageCollection(s.current,l,Object.assign(Object.assign({},u.current),{startingPoint:n}));b.current={apiInitialized:false,initialized:false,instance:r};r.setMessageCollectionHandler({onMessagesAdded:(n,l,o)=>{var i;T(n.source);k(n.source,o);U(o,false,(i=e.currentUser)===null||i===void 0?void 0:i.userId)},onMessagesUpdated:(n,l,o)=>{var i,a,r;T(n.source);k(n.source,o);U(o,false,(i=e.currentUser)===null||i===void 0?void 0:i.userId);n.source===f.EVENT_MESSAGE_UPDATED&&((r=(a=u.current).onMessagesUpdated)===null||r===void 0?void 0:r.call(a,o))},onMessagesDeleted:(e,n,l,o)=>{const i=o.map((e=>e.messageId));const a=o.filter(isSendableMessage).map((e=>e.reqId));A(i,a);w(i,a)},onChannelDeleted:(e,n)=>{var l,o;(o=(l=u.current).onChannelDeleted)===null||o===void 0?void 0:o.call(l,n)},onChannelUpdated:(e,n)=>{var l,o;C();(o=(l=u.current).onChannelUpdated)===null||o===void 0?void 0:o.call(l,n)},onHugeGapDetected:()=>{D(Number.MAX_SAFE_INTEGER,m.collection.message.defaultLimit)}});r.initialize(g.CACHE_AND_REPLACE_BY_API).onCacheResult(((n,l)=>{var i,a,r;if(n)e.isCacheEnabled&&((i=v===null||v===void 0?void 0:v.error)===null||i===void 0?void 0:i.call(v,"[useGroupChannelMessages/onCacheResult]",n));else if(l){(a=v===null||v===void 0?void 0:v.debug)===null||a===void 0?void 0:a.call(v,"[useGroupChannelMessages/onCacheResult]","message length:",l.length);U(l,true,(r=e.currentUser)===null||r===void 0?void 0:r.userId);updateUnsentMessages();if(l.length>0){b.current.initialized=true;o()}}})).onApiResult(((n,l)=>{var i,a,r,t,d;if(n)(i=v===null||v===void 0?void 0:v.warn)===null||i===void 0?void 0:i.call(v,"[useGroupChannelMessages/onApiResult]",n);else if(l){(a=v===null||v===void 0?void 0:v.debug)===null||a===void 0?void 0:a.call(v,"[useGroupChannelMessages/onApiResult]","message length:",l.length);U(l,true,(r=e.currentUser)===null||r===void 0?void 0:r.userId);u.current.startingPoint||((d=(t=u.current).onMessagesReceived)===null||d===void 0?void 0:d.call(t,l));e.isCacheEnabled&&updateUnsentMessages()}b.current.initialized=true;b.current.apiInitialized=true;o()}))}))}))));useGroupChannelHandler(e,{onUserBanned(n,l){var o,i,a;n.isGroupChannel()&&!isDifferentChannel(n,s.current)&&(l.userId===((o=e.currentUser)===null||o===void 0?void 0:o.userId)?(a=(i=u.current).onCurrentUserBanned)===null||a===void 0?void 0:a.call(i):C())}});l((()=>{const n=setTimeout((()=>E(void 0,void 0,void 0,(function*(){if(e.currentUser&&s.current){O(false);R(true);yield D(c,h);R(false);O(true)}}))));return()=>clearTimeout(n)}),[e,(t=e.currentUser)===null||t===void 0?void 0:t.userId,(d=s.current)===null||d===void 0?void 0:d.url,u.current.replyType]);n((()=>()=>{b.current.instance&&b.current.instance.dispose()}),[]);const j=usePreservedCallback((()=>E(void 0,void 0,void 0,(function*(){if(e.currentUser&&s.current){B(true);yield D(Number.MAX_SAFE_INTEGER,m.collection.message.defaultLimit);B(false)}}))));const G=usePreservedCallback((()=>E(void 0,void 0,void 0,(function*(){var n;const l=b.current.instance;if((l===null||l===void 0?void 0:l.hasPrevious)&&!p.current.prev)try{p.current.prev=true;const o=yield l.loadPrevious();U(o,false,(n=e.currentUser)===null||n===void 0?void 0:n.userId)}catch(e){}finally{p.current.prev=false}}))));const L=usePreservedCallback((()=>{const{initialized:e,instance:n}=b.current;return!(!e||!n)&&n.hasPrevious}));const N=usePreservedCallback((()=>E(void 0,void 0,void 0,(function*(){var n;const l=b.current.instance;if((l===null||l===void 0?void 0:l.hasNext)&&!p.current.next)try{p.current.next=true;const o=yield l.loadNext();U(o,false,(n=e.currentUser)===null||n===void 0?void 0:n.userId)}catch(e){}finally{p.current.next=false}}))));const V=usePreservedCallback((()=>{const{initialized:e,apiInitialized:n,instance:l}=b.current;return!!(n&&e&&l)&&l.hasNext}));const F=usePreservedCallback(((n,l)=>{var o;if(!s.current||!s.current.url){(o=v===null||v===void 0?void 0:v.error)===null||o===void 0?void 0:o.call(v,"[useGroupChannelMessages] channel is required");throw new Error("Channel is required")}return new Promise(((o,i)=>{s.current.sendUserMessage(n).onPending((n=>{var o;n.channelUrl===s.current.url&&U([n],false,(o=e.currentUser)===null||o===void 0?void 0:o.userId);l===null||l===void 0?void 0:l(n)})).onSucceeded((n=>{var l;n.channelUrl===s.current.url&&U([n],false,(l=e.currentUser)===null||l===void 0?void 0:l.userId);o(n)})).onFailed(((n,l)=>{var o;l&&l.channelUrl===s.current.url&&U([l],false,(o=e.currentUser)===null||o===void 0?void 0:o.userId);i(n)}))}))}));const q=usePreservedCallback(((n,l)=>{var o;if(!s.current||!s.current.url){(o=v===null||v===void 0?void 0:v.error)===null||o===void 0?void 0:o.call(v,"[useGroupChannelMessages] channel is required");throw new Error("Channel is required")}return new Promise(((o,i)=>{s.current.sendFileMessage(n).onPending((n=>{var o;n.channelUrl===s.current.url&&U([n],false,(o=e.currentUser)===null||o===void 0?void 0:o.userId);l===null||l===void 0?void 0:l(n)})).onSucceeded((n=>{var l;n.channelUrl===s.current.url&&U([n],false,(l=e.currentUser)===null||l===void 0?void 0:l.userId);o(n)})).onFailed(((n,l)=>{var o;l&&l.channelUrl===s.current.url&&U([l],false,(o=e.currentUser)===null||o===void 0?void 0:o.userId);i(n)}))}))}));const x=usePreservedCallback(((n,l)=>E(void 0,void 0,void 0,(function*(){var o;if(!s.current||!s.current.url){(o=v===null||v===void 0?void 0:v.error)===null||o===void 0?void 0:o.call(v,"[useGroupChannelMessages] channel is required");throw new Error("Channel is required")}return new Promise((o=>{const i=[];s.current.sendFileMessages(n).onPending((n=>{var o;n.channelUrl===s.current.url&&U([n],false,(o=e.currentUser)===null||o===void 0?void 0:o.userId);l===null||l===void 0?void 0:l(n)})).onSucceeded((l=>{var a;if(l.isFileMessage()&&l.channelUrl===s.current.url){U([l],false,(a=e.currentUser)===null||a===void 0?void 0:a.userId);i.push(l)}i.length===n.length&&o(i)})).onFailed(((l,a)=>{var r;if(a&&a.channelUrl===s.current.url){U([a],false,(r=e.currentUser)===null||r===void 0?void 0:r.userId);i.push(a)}else i.push(null);i.length===n.length&&o(i)}))}))}))));const z=usePreservedCallback(((n,l)=>{var o;if(!s.current||!s.current.url){(o=v===null||v===void 0?void 0:v.error)===null||o===void 0?void 0:o.call(v,"[useGroupChannelMessages] channel is required");throw new Error("Channel is required")}return new Promise(((o,i)=>{s.current.sendMultipleFilesMessage(n).onPending((n=>{var o;n.channelUrl===s.current.url&&U([n],false,(o=e.currentUser)===null||o===void 0?void 0:o.userId);l===null||l===void 0?void 0:l(n)})).onFileUploaded((()=>{C()})).onSucceeded((n=>{var l;n.channelUrl===s.current.url&&U([n],false,(l=e.currentUser)===null||l===void 0?void 0:l.userId);o(n)})).onFailed(((n,l)=>{var o;l&&l.channelUrl===s.current.url&&U([l],false,(o=e.currentUser)===null||o===void 0?void 0:o.userId);i(n)}))}))}));const H=usePreservedCallback(((n,l)=>E(void 0,void 0,void 0,(function*(){var o,i;if(!s.current||!s.current.url){(o=v===null||v===void 0?void 0:v.error)===null||o===void 0?void 0:o.call(v,"[useGroupChannelMessages] channel is required");throw new Error("Channel is required")}const a=yield s.current.updateUserMessage(n,l);a.channelUrl===s.current.url&&U([a],false,(i=e.currentUser)===null||i===void 0?void 0:i.userId);return a}))));const K=usePreservedCallback(((n,l)=>E(void 0,void 0,void 0,(function*(){var o,i;if(!s.current||!s.current.url){(o=v===null||v===void 0?void 0:v.error)===null||o===void 0?void 0:o.call(v,"[useGroupChannelMessages] channel is required");throw new Error("Channel is required")}const a=yield s.current.updateFileMessage(n,l);a.channelUrl===s.current.url&&U([a],false,(i=e.currentUser)===null||i===void 0?void 0:i.userId);return a}))));const W=usePreservedCallback((n=>E(void 0,void 0,void 0,(function*(){var l;if(!s.current||!s.current.url){(l=v===null||v===void 0?void 0:v.error)===null||l===void 0?void 0:l.call(v,"[useGroupChannelMessages] channel is required");throw new Error("Channel is required")}return new Promise(((l,o)=>{let i;n.isUserMessage()&&(i=s.current.resendMessage(n));n.isFileMessage()&&(i=s.current.resendMessage(n));n.isMultipleFilesMessage()&&(i=s.current.resendMessage(n));if(i){"onPending"in i&&i.onPending((n=>{var l;n.channelUrl===s.current.url&&U([n],false,(l=e.currentUser)===null||l===void 0?void 0:l.userId)}));"onFileUploaded"in i&&i.onFileUploaded((()=>{C()}));"onSucceeded"in i&&i.onSucceeded((n=>{var o;n.channelUrl===s.current.url&&U([n],false,(o=e.currentUser)===null||o===void 0?void 0:o.userId);l(n)}));"onFailed"in i&&i.onFailed(((n,l)=>{var i;l&&l.channelUrl===s.current.url&&U([l],false,(i=e.currentUser)===null||i===void 0?void 0:i.userId);o(n)}))}}))}))));const Y=usePreservedCallback((e=>E(void 0,void 0,void 0,(function*(){var n,l;if(!s.current||!s.current.url){(n=v===null||v===void 0?void 0:v.error)===null||n===void 0?void 0:n.call(v,"[useGroupChannelMessages] channel is required");throw new Error("Channel is required")}if(e.sendingStatus==="succeeded"){e.isUserMessage()&&(yield s.current.deleteMessage(e));e.isFileMessage()&&(yield s.current.deleteMessage(e));e.isMultipleFilesMessage()&&(yield s.current.deleteMessage(e))}else try{yield(l=b.current.instance)===null||l===void 0?void 0:l.removeFailedMessage(e.reqId)}finally{A([e.messageId],[e.reqId])}}))));const $=usePreservedCallback((()=>{var n;P([],true,(n=e.currentUser)===null||n===void 0?void 0:n.userId)}));const X=usePreservedCallback((n=>E(void 0,void 0,void 0,(function*(){var l;if(e.currentUser&&s.current){const o=getCollectionLimitBy(n);R(true);U([],true,(l=e.currentUser)===null||l===void 0?void 0:l.userId);yield D(n,o);R(false)}}))));return{initialized:y,loading:M,refreshing:_,messages:I,newMessages:S,resetNewMessages:$,refresh:j,loadPrevious:G,hasPrevious:L,loadNext:N,hasNext:V,
/**
         * Send user message
         * @param {UserMessageCreateParams} params user message create params
         * @param {function} [onPending] pending message callback
         * @return {Promise<UserMessage>} succeeded message
         * */
sendUserMessage:F,
/**
         * Send file message
         * @param {FileMessageCreateParams} params file message create params
         * @param {function} [onPending] pending message callback
         * @return {Promise<FileMessage>} succeeded message
         * */
sendFileMessage:q,
/**
         * Send file messages
         * @param {FileMessageCreateParams[]} paramList file message create params
         * @param {function} [onPending] pending message callback for each message request
         * @return {Promise<FileMessage[]>} succeeded or failed message
         * */
sendFileMessages:x,
/**
         * Send multiple files message
         * @param {MultipleFilesMessageCreateParams} params multiple files message create params
         * @param {function} [onPending] pending message callback
         * @return {Promise<MultipleFilesMessage>} succeeded message
         * */
sendMultipleFilesMessage:z,
/**
         * Update user message
         * @param {number} messageId
         * @param {UserMessageUpdateParams} params user message update params
         * @return {Promise<UserMessage>}
         * */
updateUserMessage:H,
/**
         * Update file message
         * @param {number} messageId
         * @param {FileMessageUpdateParams} params file message update params
         * @return {Promise<FileMessage>}
         * */
updateFileMessage:K,
/**
         * Resend failed message
         * @template {UserMessage | FileMessage | MultipleFilesMessage} T
         * @param {T} failedMessage message to resend
         * @return {Promise<T>}
         * */
resendMessage:W,
/**
         * Delete a message
         * @template {UserMessage | FileMessage | MultipleFilesMessage} T
         * @param {T} message succeeded or failed message
         * @return {Promise<void>}
         * */
deleteMessage:Y,
/**
         * Reset message list and create a new collection with starting point
         * @param {number} startingPoint
         * @param {function} callback
         * @return {void}
         * */
resetWithStartingPoint:X,_dangerous_reducer_updateMessages:U,_dangerous_reducer_deleteMessages:A}};const useIIFE=e=>iife(e);const iife=e=>e()
/**
 * Merges values from the subset object into the target object.
 *
 * @param target - The target object to merge into.
 * @param subset - The subset object from which values are merged into the target.
 * @returns A new object resulting from the merge operation.
 */;function mergeObject(e,n){const l=Object.assign({},e);Object.keys(n).forEach((e=>{Object.prototype.hasOwnProperty.call(l,e)&&isSameType(l[e],n[e])&&(typeof n[e]!=="object"||Array.isArray(n[e])?l[e]=n[e]:l[e]=mergeObject(l[e],n[e]))}));return l}const createInitialConfig=()=>({common:{enableUsingDefaultUserProfile:false},groupChannel:{channel:{enableMention:false,enableOgtag:true,enableReactions:true,enableReactionsSupergroup:false,enableTypingIndicator:true,enableVoiceMessage:false,input:{camera:{enablePhoto:true,enableVideo:true},enableDocument:true,gallery:{enablePhoto:true,enableVideo:true}},replyType:"quote_reply",threadReplySelectType:"thread",typingIndicatorTypes:new Set(["text"]),enableFeedback:false,enableSuggestedReplies:false,showSuggestedRepliesFor:"last_message_only"},channelList:{enableMessageReceiptStatus:false,enableTypingIndicator:false},setting:{enableMessageSearch:false}},openChannel:{channel:{enableOgtag:true,input:{camera:{enablePhoto:true,enableVideo:true},enableDocument:true,gallery:{enablePhoto:true,enableVideo:true}}}}});function deleteLocalConfigs(e){delete e.groupChannel.channel.typingIndicatorTypes;delete e.groupChannel.channel.enableFeedback;delete e.groupChannel.channel.enableSuggestedReplies;delete e.groupChannel.channel.showSuggestedRepliesFor;return e}const createInitialRemoteConfig=()=>{const e=createInitialConfig();return deleteLocalConfigs(e)};const w=createInitialConfig();const A=createInitialRemoteConfig();var O=(void 0,function(e,n,l,o){function adopt(e){return e instanceof l?e:new l((function(n){n(e)}))}return new(l||(l=Promise))((function(l,i){function fulfilled(e){try{step(o.next(e))}catch(e){i(e)}}function rejected(e){try{step(o.throw(e))}catch(e){i(e)}}function step(e){e.done?l(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,n||[])).next())}))});const R={items:{},getItem(e){var n;return O(this,void 0,void 0,(function*(){return(n=R.items[e])!==null&&n!==void 0?n:null}))},setItem(e,n){return O(this,void 0,void 0,(function*(){R.items[e]=n}))}};class UIKitConfigManager{constructor(e){this.storage=e!==null&&e!==void 0?e:R}init(e){this.key=`sbu@${e}.uikitConfiguration`;return this.get()}get safeKey(){if(!this.key)throw new Error("Please UIKitConfigManager.init() first");return this.key}update(e){return O(this,void 0,void 0,(function*(){const n=yield this.get();const l={updatedAt:e.updatedAt,configuration:mergeObject(n.configuration,e.configuration)};yield this.storage.setItem(this.safeKey,JSON.stringify(l));return l}))}get(){return O(this,void 0,void 0,(function*(){const e={updatedAt:0,configuration:A};try{const n=yield this.storage.getItem(this.safeKey);return n?JSON.parse(n):e}catch(n){return e}}))}}function updateCommonConfigs(e,n,l){var o,i;l.common&&isBoolean((o=l.common)===null||o===void 0?void 0:o.enableUsingDefaultUserProfile)&&(e.enableUsingDefaultUserProfile=l.common.enableUsingDefaultUserProfile);n.common&&isBoolean((i=n.common)===null||i===void 0?void 0:i.enableUsingDefaultUserProfile)&&(e.enableUsingDefaultUserProfile=n.common.enableUsingDefaultUserProfile)}function updateGroupChannelConfigs(e,n,l){updateChannelConfig$1(e,n,l);updateChannelInputConfig$1(e,n,l);updateChannelListConfig(e,n,l);updateChannelSettingConfig(e,n,l)}function updateChannelConfig$1(e,n,l){var o,i,a,r,t,d,u,s,v,c,h,p,g,f,C,b,y,m,M,_,I,S,U,P,E,w,A,O,R,B,T,k,D,j,G,L,N,V,F,q,x,z,H,K,W,Y,$,X,J,Q,Z,ee,ne,le,oe,ie,ae,re,te,de,ue,se,ve,ce,he,pe,ge,fe,Ce,be,ye,me,Me,_e,Ie,Se,Ue,Pe,Ee,we,Ae,Oe,Re,Be,Te,ke,De,je,Ge,Le,Ne,Ve,Fe,qe,xe,ze,He,Ke;((o=l.groupChannel)===null||o===void 0?void 0:o.channel)&&isBoolean((a=(i=l.groupChannel)===null||i===void 0?void 0:i.channel)===null||a===void 0?void 0:a.enableOgtag)&&(e.channel.enableOgtag=l.groupChannel.channel.enableOgtag);((r=n.groupChannel)===null||r===void 0?void 0:r.channel)&&isBoolean((d=(t=n.groupChannel)===null||t===void 0?void 0:t.channel)===null||d===void 0?void 0:d.enableOgtag)&&(e.channel.enableOgtag=(s=(u=n.groupChannel)===null||u===void 0?void 0:u.channel)===null||s===void 0?void 0:s.enableOgtag);((v=l.groupChannel)===null||v===void 0?void 0:v.channel)&&isBoolean((h=(c=l.groupChannel)===null||c===void 0?void 0:c.channel)===null||h===void 0?void 0:h.enableTypingIndicator)&&(e.channel.enableTypingIndicator=(g=(p=l.groupChannel)===null||p===void 0?void 0:p.channel)===null||g===void 0?void 0:g.enableTypingIndicator);((f=n.groupChannel)===null||f===void 0?void 0:f.channel)&&isBoolean((b=(C=n.groupChannel)===null||C===void 0?void 0:C.channel)===null||b===void 0?void 0:b.enableTypingIndicator)&&(e.channel.enableTypingIndicator=(m=(y=n.groupChannel)===null||y===void 0?void 0:y.channel)===null||m===void 0?void 0:m.enableTypingIndicator);((M=l.groupChannel)===null||M===void 0?void 0:M.channel)&&isBoolean((I=(_=l.groupChannel)===null||_===void 0?void 0:_.channel)===null||I===void 0?void 0:I.enableReactions)&&(e.channel.enableReactions=(U=(S=l.groupChannel)===null||S===void 0?void 0:S.channel)===null||U===void 0?void 0:U.enableReactions);((P=n.groupChannel)===null||P===void 0?void 0:P.channel)&&isBoolean((w=(E=n.groupChannel)===null||E===void 0?void 0:E.channel)===null||w===void 0?void 0:w.enableReactions)&&(e.channel.enableReactions=(O=(A=n.groupChannel)===null||A===void 0?void 0:A.channel)===null||O===void 0?void 0:O.enableReactions);((R=l.groupChannel)===null||R===void 0?void 0:R.channel)&&isBoolean((T=(B=l.groupChannel)===null||B===void 0?void 0:B.channel)===null||T===void 0?void 0:T.enableReactionsSupergroup)&&(e.channel.enableReactionsSupergroup=(D=(k=l.groupChannel)===null||k===void 0?void 0:k.channel)===null||D===void 0?void 0:D.enableReactionsSupergroup);((j=n.groupChannel)===null||j===void 0?void 0:j.channel)&&isBoolean((L=(G=n.groupChannel)===null||G===void 0?void 0:G.channel)===null||L===void 0?void 0:L.enableReactionsSupergroup)&&(e.channel.enableReactionsSupergroup=(V=(N=n.groupChannel)===null||N===void 0?void 0:N.channel)===null||V===void 0?void 0:V.enableReactionsSupergroup);((F=l.groupChannel)===null||F===void 0?void 0:F.channel)&&isBoolean((x=(q=l.groupChannel)===null||q===void 0?void 0:q.channel)===null||x===void 0?void 0:x.enableMention)&&(e.channel.enableMention=(H=(z=l.groupChannel)===null||z===void 0?void 0:z.channel)===null||H===void 0?void 0:H.enableMention);((K=n.groupChannel)===null||K===void 0?void 0:K.channel)&&isBoolean((Y=(W=n.groupChannel)===null||W===void 0?void 0:W.channel)===null||Y===void 0?void 0:Y.enableMention)&&(e.channel.enableMention=(X=($=n.groupChannel)===null||$===void 0?void 0:$.channel)===null||X===void 0?void 0:X.enableMention);((J=l.groupChannel)===null||J===void 0?void 0:J.channel)&&isOneOf((Z=(Q=l.groupChannel)===null||Q===void 0?void 0:Q.channel)===null||Z===void 0?void 0:Z.replyType,["none","quote_reply","thread"])&&(e.channel.replyType=(ne=(ee=l.groupChannel)===null||ee===void 0?void 0:ee.channel)===null||ne===void 0?void 0:ne.replyType);((le=n.groupChannel)===null||le===void 0?void 0:le.channel)&&isOneOf((ie=(oe=n.groupChannel)===null||oe===void 0?void 0:oe.channel)===null||ie===void 0?void 0:ie.replyType,["none","quote_reply","thread"])&&(e.channel.replyType=(re=(ae=n.groupChannel)===null||ae===void 0?void 0:ae.channel)===null||re===void 0?void 0:re.replyType);((te=l.groupChannel)===null||te===void 0?void 0:te.channel)&&isOneOf((ue=(de=l.groupChannel)===null||de===void 0?void 0:de.channel)===null||ue===void 0?void 0:ue.threadReplySelectType,["thread","parent"])&&(e.channel.threadReplySelectType=(ve=(se=l.groupChannel)===null||se===void 0?void 0:se.channel)===null||ve===void 0?void 0:ve.threadReplySelectType);((ce=n.groupChannel)===null||ce===void 0?void 0:ce.channel)&&isOneOf((pe=(he=n.groupChannel)===null||he===void 0?void 0:he.channel)===null||pe===void 0?void 0:pe.threadReplySelectType,["thread","parent"])&&(e.channel.threadReplySelectType=(fe=(ge=n.groupChannel)===null||ge===void 0?void 0:ge.channel)===null||fe===void 0?void 0:fe.threadReplySelectType);((Ce=l.groupChannel)===null||Ce===void 0?void 0:Ce.channel)&&isBoolean((ye=(be=l.groupChannel)===null||be===void 0?void 0:be.channel)===null||ye===void 0?void 0:ye.enableVoiceMessage)&&(e.channel.enableVoiceMessage=(Me=(me=l.groupChannel)===null||me===void 0?void 0:me.channel)===null||Me===void 0?void 0:Me.enableVoiceMessage);((_e=n.groupChannel)===null||_e===void 0?void 0:_e.channel)&&isBoolean((Se=(Ie=n.groupChannel)===null||Ie===void 0?void 0:Ie.channel)===null||Se===void 0?void 0:Se.enableVoiceMessage)&&(e.channel.enableVoiceMessage=(Pe=(Ue=n.groupChannel)===null||Ue===void 0?void 0:Ue.channel)===null||Pe===void 0?void 0:Pe.enableVoiceMessage);((Ee=n.groupChannel)===null||Ee===void 0?void 0:Ee.channel)&&isSet((Ae=(we=n.groupChannel)===null||we===void 0?void 0:we.channel)===null||Ae===void 0?void 0:Ae.typingIndicatorTypes)&&(e.channel.typingIndicatorTypes=(Re=(Oe=n.groupChannel)===null||Oe===void 0?void 0:Oe.channel)===null||Re===void 0?void 0:Re.typingIndicatorTypes);((Be=n.groupChannel)===null||Be===void 0?void 0:Be.channel)&&isBoolean((ke=(Te=n.groupChannel)===null||Te===void 0?void 0:Te.channel)===null||ke===void 0?void 0:ke.enableFeedback)&&(e.channel.enableFeedback=(je=(De=n.groupChannel)===null||De===void 0?void 0:De.channel)===null||je===void 0?void 0:je.enableFeedback);((Ge=n.groupChannel)===null||Ge===void 0?void 0:Ge.channel)&&isBoolean((Ne=(Le=n.groupChannel)===null||Le===void 0?void 0:Le.channel)===null||Ne===void 0?void 0:Ne.enableSuggestedReplies)&&(e.channel.enableSuggestedReplies=(Fe=(Ve=n.groupChannel)===null||Ve===void 0?void 0:Ve.channel)===null||Fe===void 0?void 0:Fe.enableSuggestedReplies);((qe=n.groupChannel)===null||qe===void 0?void 0:qe.channel)&&isOneOf((ze=(xe=n.groupChannel)===null||xe===void 0?void 0:xe.channel)===null||ze===void 0?void 0:ze.showSuggestedRepliesFor,["all_messages","last_message_only"])&&(e.channel.showSuggestedRepliesFor=(Ke=(He=n.groupChannel)===null||He===void 0?void 0:He.channel)===null||Ke===void 0?void 0:Ke.showSuggestedRepliesFor)}function updateChannelInputConfig$1(e,n,l){var o,i,a,r,t,d,u,s,v,c,h,p,g,f,C,b,y,m,M,_,I,S,U,P,E,w,A,O,R,B,T,k,D,j,G,L,N,V,F,q,x,z,H,K,W,Y,$,X,J,Q,Z,ee,ne,le,oe,ie,ae,re,te,de,ue,se,ve,ce,he,pe,ge,fe,Ce,be,ye,me,Me,_e,Ie,Se,Ue,Pe,Ee,we,Ae,Oe,Re,Be,Te,ke,De,je,Ge,Le,Ne,Ve,Fe,qe,xe,ze,He,Ke,We,Ye,$e,Xe,Je,Qe;((i=(o=l.groupChannel)===null||o===void 0?void 0:o.channel)===null||i===void 0?void 0:i.input)&&isBoolean((t=(r=(a=l.groupChannel)===null||a===void 0?void 0:a.channel)===null||r===void 0?void 0:r.input)===null||t===void 0?void 0:t.enableDocument)&&(e.channel.input.enableDocument=(s=(u=(d=l.groupChannel)===null||d===void 0?void 0:d.channel)===null||u===void 0?void 0:u.input)===null||s===void 0?void 0:s.enableDocument);((c=(v=n.groupChannel)===null||v===void 0?void 0:v.channel)===null||c===void 0?void 0:c.input)&&isBoolean((g=(p=(h=n.groupChannel)===null||h===void 0?void 0:h.channel)===null||p===void 0?void 0:p.input)===null||g===void 0?void 0:g.enableDocument)&&(e.channel.input.enableDocument=(b=(C=(f=n.groupChannel)===null||f===void 0?void 0:f.channel)===null||C===void 0?void 0:C.input)===null||b===void 0?void 0:b.enableDocument);((M=(m=(y=l.groupChannel)===null||y===void 0?void 0:y.channel)===null||m===void 0?void 0:m.input)===null||M===void 0?void 0:M.camera)&&isBoolean((U=(S=(I=(_=l.groupChannel)===null||_===void 0?void 0:_.channel)===null||I===void 0?void 0:I.input)===null||S===void 0?void 0:S.camera)===null||U===void 0?void 0:U.enablePhoto)&&(e.channel.input.camera.enablePhoto=(A=(w=(E=(P=l.groupChannel)===null||P===void 0?void 0:P.channel)===null||E===void 0?void 0:E.input)===null||w===void 0?void 0:w.camera)===null||A===void 0?void 0:A.enablePhoto);((B=(R=(O=n.groupChannel)===null||O===void 0?void 0:O.channel)===null||R===void 0?void 0:R.input)===null||B===void 0?void 0:B.camera)&&isBoolean((j=(D=(k=(T=n.groupChannel)===null||T===void 0?void 0:T.channel)===null||k===void 0?void 0:k.input)===null||D===void 0?void 0:D.camera)===null||j===void 0?void 0:j.enablePhoto)&&(e.channel.input.camera.enablePhoto=(V=(N=(L=(G=n.groupChannel)===null||G===void 0?void 0:G.channel)===null||L===void 0?void 0:L.input)===null||N===void 0?void 0:N.camera)===null||V===void 0?void 0:V.enablePhoto);((x=(q=(F=l.groupChannel)===null||F===void 0?void 0:F.channel)===null||q===void 0?void 0:q.input)===null||x===void 0?void 0:x.camera)&&isBoolean((W=(K=(H=(z=l.groupChannel)===null||z===void 0?void 0:z.channel)===null||H===void 0?void 0:H.input)===null||K===void 0?void 0:K.camera)===null||W===void 0?void 0:W.enableVideo)&&(e.channel.input.camera.enableVideo=(J=(X=($=(Y=l.groupChannel)===null||Y===void 0?void 0:Y.channel)===null||$===void 0?void 0:$.input)===null||X===void 0?void 0:X.camera)===null||J===void 0?void 0:J.enableVideo);((ee=(Z=(Q=n.groupChannel)===null||Q===void 0?void 0:Q.channel)===null||Z===void 0?void 0:Z.input)===null||ee===void 0?void 0:ee.camera)&&isBoolean((ie=(oe=(le=(ne=n.groupChannel)===null||ne===void 0?void 0:ne.channel)===null||le===void 0?void 0:le.input)===null||oe===void 0?void 0:oe.camera)===null||ie===void 0?void 0:ie.enableVideo)&&(e.channel.input.camera.enableVideo=(de=(te=(re=(ae=n.groupChannel)===null||ae===void 0?void 0:ae.channel)===null||re===void 0?void 0:re.input)===null||te===void 0?void 0:te.camera)===null||de===void 0?void 0:de.enableVideo);((ve=(se=(ue=l.groupChannel)===null||ue===void 0?void 0:ue.channel)===null||se===void 0?void 0:se.input)===null||ve===void 0?void 0:ve.gallery)&&isBoolean((ge=(pe=(he=(ce=l.groupChannel)===null||ce===void 0?void 0:ce.channel)===null||he===void 0?void 0:he.input)===null||pe===void 0?void 0:pe.gallery)===null||ge===void 0?void 0:ge.enablePhoto)&&(e.channel.input.gallery.enablePhoto=(ye=(be=(Ce=(fe=l.groupChannel)===null||fe===void 0?void 0:fe.channel)===null||Ce===void 0?void 0:Ce.input)===null||be===void 0?void 0:be.gallery)===null||ye===void 0?void 0:ye.enablePhoto);((_e=(Me=(me=n.groupChannel)===null||me===void 0?void 0:me.channel)===null||Me===void 0?void 0:Me.input)===null||_e===void 0?void 0:_e.gallery)&&isBoolean((Pe=(Ue=(Se=(Ie=n.groupChannel)===null||Ie===void 0?void 0:Ie.channel)===null||Se===void 0?void 0:Se.input)===null||Ue===void 0?void 0:Ue.gallery)===null||Pe===void 0?void 0:Pe.enablePhoto)&&(e.channel.input.gallery.enablePhoto=(Oe=(Ae=(we=(Ee=n.groupChannel)===null||Ee===void 0?void 0:Ee.channel)===null||we===void 0?void 0:we.input)===null||Ae===void 0?void 0:Ae.gallery)===null||Oe===void 0?void 0:Oe.enablePhoto);((Te=(Be=(Re=l.groupChannel)===null||Re===void 0?void 0:Re.channel)===null||Be===void 0?void 0:Be.input)===null||Te===void 0?void 0:Te.gallery)&&isBoolean((Ge=(je=(De=(ke=l.groupChannel)===null||ke===void 0?void 0:ke.channel)===null||De===void 0?void 0:De.input)===null||je===void 0?void 0:je.gallery)===null||Ge===void 0?void 0:Ge.enableVideo)&&(e.channel.input.gallery.enableVideo=(Fe=(Ve=(Ne=(Le=l.groupChannel)===null||Le===void 0?void 0:Le.channel)===null||Ne===void 0?void 0:Ne.input)===null||Ve===void 0?void 0:Ve.gallery)===null||Fe===void 0?void 0:Fe.enableVideo);((ze=(xe=(qe=n.groupChannel)===null||qe===void 0?void 0:qe.channel)===null||xe===void 0?void 0:xe.input)===null||ze===void 0?void 0:ze.gallery)&&isBoolean((Ye=(We=(Ke=(He=n.groupChannel)===null||He===void 0?void 0:He.channel)===null||Ke===void 0?void 0:Ke.input)===null||We===void 0?void 0:We.gallery)===null||Ye===void 0?void 0:Ye.enableVideo)&&(e.channel.input.gallery.enableVideo=(Qe=(Je=(Xe=($e=n.groupChannel)===null||$e===void 0?void 0:$e.channel)===null||Xe===void 0?void 0:Xe.input)===null||Je===void 0?void 0:Je.gallery)===null||Qe===void 0?void 0:Qe.enableVideo)}function updateChannelListConfig(e,n,l){var o,i,a,r,t,d,u,s,v,c,h,p,g,f,C,b,y,m;((o=l.groupChannel)===null||o===void 0?void 0:o.channelList)&&isBoolean((a=(i=l.groupChannel)===null||i===void 0?void 0:i.channelList)===null||a===void 0?void 0:a.enableTypingIndicator)&&(e.channelList.enableTypingIndicator=l.groupChannel.channelList.enableTypingIndicator);((r=n.groupChannel)===null||r===void 0?void 0:r.channelList)&&isBoolean((d=(t=n.groupChannel)===null||t===void 0?void 0:t.channelList)===null||d===void 0?void 0:d.enableTypingIndicator)&&(e.channelList.enableTypingIndicator=(s=(u=n.groupChannel)===null||u===void 0?void 0:u.channelList)===null||s===void 0?void 0:s.enableTypingIndicator);((v=l.groupChannel)===null||v===void 0?void 0:v.channelList)&&isBoolean((h=(c=l.groupChannel)===null||c===void 0?void 0:c.channelList)===null||h===void 0?void 0:h.enableMessageReceiptStatus)&&(e.channelList.enableMessageReceiptStatus=(g=(p=l.groupChannel)===null||p===void 0?void 0:p.channelList)===null||g===void 0?void 0:g.enableMessageReceiptStatus);((f=n.groupChannel)===null||f===void 0?void 0:f.channelList)&&isBoolean((b=(C=n.groupChannel)===null||C===void 0?void 0:C.channelList)===null||b===void 0?void 0:b.enableMessageReceiptStatus)&&(e.channelList.enableMessageReceiptStatus=(m=(y=n.groupChannel)===null||y===void 0?void 0:y.channelList)===null||m===void 0?void 0:m.enableMessageReceiptStatus)}function updateChannelSettingConfig(e,n,l){var o,i,a,r,t,d,u,s;((o=l.groupChannel)===null||o===void 0?void 0:o.setting)&&isBoolean((a=(i=l.groupChannel)===null||i===void 0?void 0:i.setting)===null||a===void 0?void 0:a.enableMessageSearch)&&(e.setting.enableMessageSearch=l.groupChannel.setting.enableMessageSearch);((r=n.groupChannel)===null||r===void 0?void 0:r.setting)&&isBoolean((d=(t=n.groupChannel)===null||t===void 0?void 0:t.setting)===null||d===void 0?void 0:d.enableMessageSearch)&&(e.setting.enableMessageSearch=(s=(u=n.groupChannel)===null||u===void 0?void 0:u.setting)===null||s===void 0?void 0:s.enableMessageSearch)}function updateOpenChannelConfigs(e,n,l){updateChannelConfig(e,n,l);updateChannelInputConfig(e,n,l)}function updateChannelConfig(e,n,l){var o,i,a,r,t,d,u,s;((o=l.openChannel)===null||o===void 0?void 0:o.channel)&&isBoolean((a=(i=l.openChannel)===null||i===void 0?void 0:i.channel)===null||a===void 0?void 0:a.enableOgtag)&&(e.channel.enableOgtag=l.openChannel.channel.enableOgtag);((r=n.openChannel)===null||r===void 0?void 0:r.channel)&&isBoolean((d=(t=n.openChannel)===null||t===void 0?void 0:t.channel)===null||d===void 0?void 0:d.enableOgtag)&&(e.channel.enableOgtag=(s=(u=n.openChannel)===null||u===void 0?void 0:u.channel)===null||s===void 0?void 0:s.enableOgtag)}function updateChannelInputConfig(e,n,l){var o,i,a,r,t,d,u,s,v,c,h,p,g,f,C,b,y,m,M,_,I,S,U,P,E,w,A,O,R,B,T,k,D,j,G,L,N,V,F,q,x,z,H,K,W,Y,$,X,J,Q,Z,ee,ne,le,oe,ie,ae,re,te,de,ue,se,ve,ce,he,pe,ge,fe,Ce,be,ye,me,Me,_e,Ie,Se,Ue,Pe,Ee,we,Ae,Oe,Re,Be,Te,ke,De,je,Ge,Le,Ne,Ve,Fe,qe,xe,ze,He,Ke,We,Ye,$e,Xe,Je,Qe;((i=(o=l.openChannel)===null||o===void 0?void 0:o.channel)===null||i===void 0?void 0:i.input)&&isBoolean((t=(r=(a=l.openChannel)===null||a===void 0?void 0:a.channel)===null||r===void 0?void 0:r.input)===null||t===void 0?void 0:t.enableDocument)&&(e.channel.input.enableDocument=(s=(u=(d=l.openChannel)===null||d===void 0?void 0:d.channel)===null||u===void 0?void 0:u.input)===null||s===void 0?void 0:s.enableDocument);((c=(v=n.openChannel)===null||v===void 0?void 0:v.channel)===null||c===void 0?void 0:c.input)&&isBoolean((g=(p=(h=n.openChannel)===null||h===void 0?void 0:h.channel)===null||p===void 0?void 0:p.input)===null||g===void 0?void 0:g.enableDocument)&&(e.channel.input.enableDocument=(b=(C=(f=n.openChannel)===null||f===void 0?void 0:f.channel)===null||C===void 0?void 0:C.input)===null||b===void 0?void 0:b.enableDocument);((M=(m=(y=l.openChannel)===null||y===void 0?void 0:y.channel)===null||m===void 0?void 0:m.input)===null||M===void 0?void 0:M.camera)&&isBoolean((U=(S=(I=(_=l.openChannel)===null||_===void 0?void 0:_.channel)===null||I===void 0?void 0:I.input)===null||S===void 0?void 0:S.camera)===null||U===void 0?void 0:U.enablePhoto)&&(e.channel.input.camera.enablePhoto=(A=(w=(E=(P=l.openChannel)===null||P===void 0?void 0:P.channel)===null||E===void 0?void 0:E.input)===null||w===void 0?void 0:w.camera)===null||A===void 0?void 0:A.enablePhoto);((B=(R=(O=n.openChannel)===null||O===void 0?void 0:O.channel)===null||R===void 0?void 0:R.input)===null||B===void 0?void 0:B.camera)&&isBoolean((j=(D=(k=(T=n.openChannel)===null||T===void 0?void 0:T.channel)===null||k===void 0?void 0:k.input)===null||D===void 0?void 0:D.camera)===null||j===void 0?void 0:j.enablePhoto)&&(e.channel.input.camera.enablePhoto=(V=(N=(L=(G=n.openChannel)===null||G===void 0?void 0:G.channel)===null||L===void 0?void 0:L.input)===null||N===void 0?void 0:N.camera)===null||V===void 0?void 0:V.enablePhoto);((x=(q=(F=l.openChannel)===null||F===void 0?void 0:F.channel)===null||q===void 0?void 0:q.input)===null||x===void 0?void 0:x.camera)&&isBoolean((W=(K=(H=(z=l.openChannel)===null||z===void 0?void 0:z.channel)===null||H===void 0?void 0:H.input)===null||K===void 0?void 0:K.camera)===null||W===void 0?void 0:W.enableVideo)&&(e.channel.input.camera.enableVideo=(J=(X=($=(Y=l.openChannel)===null||Y===void 0?void 0:Y.channel)===null||$===void 0?void 0:$.input)===null||X===void 0?void 0:X.camera)===null||J===void 0?void 0:J.enableVideo);((ee=(Z=(Q=n.openChannel)===null||Q===void 0?void 0:Q.channel)===null||Z===void 0?void 0:Z.input)===null||ee===void 0?void 0:ee.camera)&&isBoolean((ie=(oe=(le=(ne=n.openChannel)===null||ne===void 0?void 0:ne.channel)===null||le===void 0?void 0:le.input)===null||oe===void 0?void 0:oe.camera)===null||ie===void 0?void 0:ie.enableVideo)&&(e.channel.input.camera.enableVideo=(de=(te=(re=(ae=n.openChannel)===null||ae===void 0?void 0:ae.channel)===null||re===void 0?void 0:re.input)===null||te===void 0?void 0:te.camera)===null||de===void 0?void 0:de.enableVideo);((ve=(se=(ue=l.openChannel)===null||ue===void 0?void 0:ue.channel)===null||se===void 0?void 0:se.input)===null||ve===void 0?void 0:ve.gallery)&&isBoolean((ge=(pe=(he=(ce=l.openChannel)===null||ce===void 0?void 0:ce.channel)===null||he===void 0?void 0:he.input)===null||pe===void 0?void 0:pe.gallery)===null||ge===void 0?void 0:ge.enablePhoto)&&(e.channel.input.gallery.enablePhoto=(ye=(be=(Ce=(fe=l.openChannel)===null||fe===void 0?void 0:fe.channel)===null||Ce===void 0?void 0:Ce.input)===null||be===void 0?void 0:be.gallery)===null||ye===void 0?void 0:ye.enablePhoto);((_e=(Me=(me=n.openChannel)===null||me===void 0?void 0:me.channel)===null||Me===void 0?void 0:Me.input)===null||_e===void 0?void 0:_e.gallery)&&isBoolean((Pe=(Ue=(Se=(Ie=n.openChannel)===null||Ie===void 0?void 0:Ie.channel)===null||Se===void 0?void 0:Se.input)===null||Ue===void 0?void 0:Ue.gallery)===null||Pe===void 0?void 0:Pe.enablePhoto)&&(e.channel.input.gallery.enablePhoto=(Oe=(Ae=(we=(Ee=n.openChannel)===null||Ee===void 0?void 0:Ee.channel)===null||we===void 0?void 0:we.input)===null||Ae===void 0?void 0:Ae.gallery)===null||Oe===void 0?void 0:Oe.enablePhoto);((Te=(Be=(Re=l.openChannel)===null||Re===void 0?void 0:Re.channel)===null||Be===void 0?void 0:Be.input)===null||Te===void 0?void 0:Te.gallery)&&isBoolean((Ge=(je=(De=(ke=l.openChannel)===null||ke===void 0?void 0:ke.channel)===null||De===void 0?void 0:De.input)===null||je===void 0?void 0:je.gallery)===null||Ge===void 0?void 0:Ge.enableVideo)&&(e.channel.input.gallery.enableVideo=(Fe=(Ve=(Ne=(Le=l.openChannel)===null||Le===void 0?void 0:Le.channel)===null||Ne===void 0?void 0:Ne.input)===null||Ve===void 0?void 0:Ve.gallery)===null||Fe===void 0?void 0:Fe.enableVideo);((ze=(xe=(qe=n.openChannel)===null||qe===void 0?void 0:qe.channel)===null||xe===void 0?void 0:xe.input)===null||ze===void 0?void 0:ze.gallery)&&isBoolean((Ye=(We=(Ke=(He=n.openChannel)===null||He===void 0?void 0:He.channel)===null||Ke===void 0?void 0:Ke.input)===null||We===void 0?void 0:We.gallery)===null||Ye===void 0?void 0:Ye.enableVideo)&&(e.channel.input.gallery.enableVideo=(Qe=(Je=(Xe=($e=n.openChannel)===null||$e===void 0?void 0:$e.channel)===null||Xe===void 0?void 0:Xe.input)===null||Je===void 0?void 0:Je.gallery)===null||Qe===void 0?void 0:Qe.enableVideo)}
/**
 * @param localConfigs Set directly in code level. It has higher priority than remote ones
 * @param remoteConfigs Set by Feature Config setting in Dashboard
 * @returns SBUConfig
 */function getConfigsByPriority(e,n){const l=createInitialConfig();updateCommonConfigs(l.common,e,n);updateGroupChannelConfigs(l.groupChannel,e,n);updateOpenChannelConfigs(l.openChannel,e,n);return l}
/**
 * @param json UIKitConfiguration's json
 * @returns boolean
 * */function isRawSBUConfigPayload(e){return typeof e==="object"&&"configuration"in e&&"updated_at"in e}var B=(void 0,function(e,n,l,o){function adopt(e){return e instanceof l?e:new l((function(n){n(e)}))}return new(l||(l=Promise))((function(l,i){function fulfilled(e){try{step(o.next(e))}catch(e){i(e)}}function rejected(e){try{step(o.throw(e))}catch(e){i(e)}}function step(e){e.done?l(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,n||[])).next())}))});function getApplicationAttributes(e){var n,l;return(l=(n=e.appInfo)===null||n===void 0?void 0:n.applicationAttributes)!==null&&l!==void 0?l:[]}const T=d({initDashboardConfigs:()=>Promise.resolve(),configs:w,configsWithAppAttr:()=>w});const UIKitConfigProvider=({storage:n,children:l,localConfigs:i={}})=>{const[r,t]=o(createInitialRemoteConfig);const[d]=o((()=>new UIKitConfigManager(n)));const u=a((e=>B(void 0,void 0,void 0,(function*(){const n=yield d.init(e.appId);if(e.appInfo&&e.appInfo.uikitConfigInfo.lastUpdatedAt===n.updatedAt)t(n.configuration);else try{const n=yield e.getUIKitConfiguration();if(isRawSBUConfigPayload(n.json)){const e=snakeToCamel(n.json);const l=yield d.update(e);t(l.configuration)}}catch(e){t(n.configuration)}}))),[d]);const s=getConfigsByPriority(i,r);const v=usePreservedCallback((e=>({groupChannel:{channel:{get enableReactions(){return s.groupChannel.channel.enableReactions&&getApplicationAttributes(e).includes(b.reactions)},get enableReactionsSupergroup(){return s.groupChannel.channel.enableReactionsSupergroup&&getApplicationAttributes(e).includes(b.reactions)},get enableOgtag(){return s.groupChannel.channel.enableOgtag&&getApplicationAttributes(e).includes(b.enable_og_tag)}},setting:{get enableMessageSearch(){return s.groupChannel.setting.enableMessageSearch&&getApplicationAttributes(e).includes(b.message_search_v3)}}},openChannel:{channel:{get enableOgtag(){return s.openChannel.channel.enableOgtag&&getApplicationAttributes(e).includes(b.enable_og_tag)}}}})));return e.createElement(T.Provider,{value:{initDashboardConfigs:u,configs:s,configsWithAppAttr:v}},l)};const useUIKitConfig=()=>u(T);export{T as UIKitConfigContext,UIKitConfigProvider,b as applicationAttributes,w as initialConfig,A as initialRemoteConfig,y as premiumFeatures,m as sbuConstants,useAsyncEffect,useAsyncLayoutEffect,useForceUpdate,useGroupChannelHandler,useGroupChannelList,useGroupChannelMessages,useIIFE,usePreservedCallback,useUIKitConfig,useUniqId};

